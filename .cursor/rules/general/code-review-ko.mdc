---
# ⚠️ 이 파일은 AI가 읽지 않습니다 (Human Reference Only)
# AI는 code-review.mdc (영문판)만 참조합니다
---

# 🔍 코드 리뷰 가이드라인

## 역할 정의
당신은 체계적인 코드 리뷰를 통해 높은 품질의 코드를 보장할 책임이 있습니다. 모든 코드 변경사항은 메인 브랜치에 병합되기 전에 리뷰되어야 합니다.

---

## 🚨 필수 코드 리뷰

### ❌ 금지 사항
1. **메인 브랜치에 직접 커밋 금지** - 항상 Pull Request 사용
2. **셀프 머지 금지** - 최소 1명의 리뷰어 승인 필요
3. **CI/CD 건너뛰기 금지** - 모든 검사 통과 필수
4. **메인 브랜치 Force Push 금지** - 메인 브랜치 무결성 보호

### ✅ 필수 사항
1. **Pull Request 생성** - 모든 코드 변경사항에 대해
2. **체크리스트 완료** - 리뷰 요청 전
3. **피드백 응답** - 모든 리뷰 코멘트 처리
4. **테스트 업데이트** - 코드와 테스트 동기화 유지

---

## 📋 Pull Request 템플릿

### PR 제목 형식
```
<타입>(<범위>): <간단한 설명>

예시:
feat(auth): JWT 토큰 갱신 메커니즘 추가
fix(database): 사용자 목록 N+1 쿼리 해결
refactor(frontend): React 컴포넌트 렌더링 최적화
```

### PR 설명 템플릿
```markdown
## 설명
이 PR이 무엇을 하는지 간단히 설명

## 변경 유형
- [ ] 버그 수정 (기존 기능을 수정하는 비중단 변경)
- [ ] 새 기능 (기능을 추가하는 비중단 변경)
- [ ] 중단 변경 (기존 기능이 작동하지 않게 하는 수정 또는 기능)
- [ ] 리팩토링 (기능 변경 없음)
- [ ] 문서 업데이트

## 관련 이슈
Closes #123
Fixes #456

## 변경 사항
- JWT 토큰 갱신 엔드포인트 추가
- 인증 미들웨어 업데이트
- refresh_token 필드 포함하도록 사용자 모델 수정

## 테스트
- [ ] 단위 테스트 추가/업데이트
- [ ] 통합 테스트 추가/업데이트
- [ ] 수동 테스트 완료
- [ ] 프로덕션과 유사한 환경에서 테스트

## 스크린샷 (해당되는 경우)
[이전] / [이후] 스크린샷

## 리뷰 전 체크리스트
- [ ] 코드가 프로젝트 스타일 가이드를 따름
- [ ] 셀프 리뷰 완료
- [ ] 복잡한 로직에 주석 추가
- [ ] 문서 업데이트
- [ ] console.log/print 디버깅 구문 없음
- [ ] 테스트 추가 및 통과
- [ ] 린터 에러 없음
- [ ] Soft delete 패턴 사용 (해당되는 경우)
- [ ] 디자인 시스템 준수 (프론트엔드인 경우)
```

---

## 🔍 리뷰어 체크리스트

### 코드 품질
- [ ] **코드가 읽기 쉽고 유지보수 가능**
  - 명확한 변수/함수 이름
  - 논리적인 코드 구성
  - 복잡한 로직에 적절한 주석

- [ ] **기존 패턴 준수**
  - 코드베이스 스타일과 일관성
  - 확립된 아키텍처 패턴 사용
  - 불필요한 중복 없음

- [ ] **코드 스멜 없음**
  - 과도하게 복잡한 함수 없음 (> 50줄)
  - 깊은 중첩 없음 (> 3레벨)
  - 매직 넘버/문자열 없음

### 기능성
- [ ] **코드가 의도한 대로 작동**
  - PR 설명과 일치
  - 명시된 문제 해결
  - 의도하지 않은 부작용 없음

- [ ] **엣지 케이스 처리**
  - Null/undefined 체크
  - 빈 배열/객체 처리
  - 경계 조건

- [ ] **적절한 에러 핸들링**
  - 필요한 곳에 try-catch 블록
  - 사용자 친화적인 에러 메시지
  - 에러 적절히 로깅

### AGROUNDS 특화 규칙
- [ ] **Soft delete 구현**
  - `deleted_at` 필드 사용
  - 하드 삭제(.delete() 호출) 없음
  - Soft delete된 레코드 필터링

- [ ] **새 파일 생성 안 함** (절대적으로 필요한 경우 제외)
  - 기존 파일만 수정
  - 새 파일 필요시 정당화

- [ ] **디자인 시스템 준수** (프론트엔드)
  - CSS 변수 사용 (하드코딩된 색상 없음)
  - 타이포그래피 시스템 준수
  - 적절한 간격

- [ ] **데이터베이스 패턴 준수** (백엔드)
  - 모델에 `managed = False`
  - Enum 타입을 choices로 매핑
  - 타임스탬프 포함 (created_at, updated_at, deleted_at)

### 보안
- [ ] **보안 취약점 없음**
  - Input validation 존재
  - SQL injection 위험 없음
  - XSS 취약점 없음
  - 하드코딩된 비밀정보/자격증명 없음

- [ ] **인증/권한 적절**
  - 보호된 엔드포인트 보안 처리
  - JWT 토큰 올바르게 처리
  - 권한 체크

### 성능
- [ ] **명백한 성능 문제 없음**
  - 데이터베이스 쿼리 최적화
  - N+1 쿼리 없음
  - 적절한 캐싱 사용
  - 효율적인 알고리즘

- [ ] **프론트엔드 최적화** (해당되는 경우)
  - 불필요한 리렌더링 없음
  - 적절한 곳에 lazy loading
  - 이미지 최적화

### 테스팅
- [ ] **테스트가 충분**
  - 모든 새 코드가 테스트로 커버됨
  - 테스트가 의미 있음 (단순 커버리지용이 아님)
  - 엣지 케이스 테스트
  - 테스트가 일관되게 통과

- [ ] **테스트가 잘 작성됨**
  - 명확한 테스트 이름
  - Arrange-Act-Assert 패턴
  - Flaky 테스트 없음

### 문서화
- [ ] **코드가 문서화됨**
  - 함수/클래스에 Docstring
  - 복잡한 로직에 주석
  - JavaScript 함수에 JSDoc

- [ ] **외부 문서 업데이트**
  - 필요시 README
  - API 문서화 (Swagger)
  - 변경된 경우 아키텍처 다이어그램

---

## 💬 효과적인 피드백 제공

### 피드백 카테고리
리뷰 코멘트에 이 접두사 사용:

**[BLOCKING]** - 병합 전 반드시 수정
```
[BLOCKING] SQL injection 취약점을 생성합니다.
대신 파라미터화된 쿼리를 사용하세요.
```

**[SUGGESTION]** - 권장하지만 필수는 아님
```
[SUGGESTION] 더 나은 성능을 위해 여기서 `useMemo` 사용을 고려하세요.
```

**[QUESTION]** - 명확화 필요
```
[QUESTION] 이전 접근 방식 대신 이 방식을 선택한 이유가 무엇인가요?
```

**[NITPICK]** - 사소한 스타일/포매팅 이슈
```
[NITPICK] 여기 빈 줄이 추가로 있네요.
```

**[PRAISE]** - 긍정적인 피드백 (중요!)
```
[PRAISE] 여기서 디자인 패턴을 훌륭하게 사용하셨네요!
```

### 효과적인 피드백 가이드라인
1. **구체적이고 실행 가능하게**
   - ❌ 나쁨: "이 코드가 지저분합니다"
   - ✅ 좋음: "45-60줄을 별도 함수로 추출하는 것을 고려하세요"

2. **'왜'를 설명**
   - ❌ 나쁨: "var 사용하지 마세요"
   - ✅ 좋음: "호이스팅 문제를 피하기 위해 var 대신 const/let 사용하세요"

3. **대안 제시**
   - ❌ 나쁨: "이건 틀렸습니다"
   - ✅ 좋음: "X 대신 Y를 고려해보세요. Z 때문입니다"

4. **존중하고 건설적으로**
   - 사람이 아닌 코드에 집중
   - 요구하는 대신 질문하기
   - 좋은 작업 인정하기

---

## ✅ 승인 프로세스

### 승인 시기
- [ ] 모든 blocking 이슈 해결됨
- [ ] 위의 모든 체크박스 체크됨
- [ ] CI/CD 통과
- [ ] 병합 충돌 없음
- [ ] 코드가 품질 기준 충족

### 변경 요청 시기
- 보안 취약점 존재
- Breaking changes 문서화되지 않음
- 테스트 누락 또는 실패
- AGROUNDS 핵심 원칙 위반
- 성능 이슈

### 코멘트만 (승인 없음) 시기
- 더 많은 정보 필요
- 제안은 있지만 코드는 수용 가능
- 접근 방식 논의하고 싶음

---

## 🔄 리뷰 응답 가이드라인

### PR 작성자용
1. **모든 코멘트에 응답**
   - 각 코멘트 처리 또는 설명
   - 수정되면 resolved로 표시
   - 설명적인 메시지로 커밋 푸시

2. **피드백을 개인적으로 받아들이지 않기**
   - 리뷰는 개인 능력이 아닌 코드 품질에 관한 것
   - 필요시 명확화 요청
   - 피드백에서 배우기

3. **PR 범위 집중 유지**
   - 관련 없는 변경사항 추가하지 않기
   - 큰 PR 분할 고려
   - PR당 하나의 기능/수정

4. **PR 설명 업데이트**
   - 접근 방식이 크게 변경된 경우
   - 새로운 이슈 발견된 경우
   - 범위가 확장된 경우

---

## 📊 코드 리뷰 메트릭

### 건강한 코드 리뷰 지표
- **리뷰 처리 시간**: < 24시간
- **PR 크기**: < 400줄 변경
- **PR당 코멘트**: 3-10개 (좋은 논의)
- **승인률**: 80%+ (품질 높은 제출)
- **수정 라운드**: 1-2회 (효율적인 소통)

### 위험 신호
- ⚠️ PR이 > 1주일 열림
- ⚠️ > 1000줄 변경
- ⚠️ 리뷰어의 코멘트 없음
- ⚠️ 여러 번의 force push
- ⚠️ > 5번의 수정 라운드

---

## 🎯 일반적인 리뷰 시나리오

### 시나리오 1: 큰 PR
```
코멘트: "이 PR이 꽤 큽니다. 다음으로 분할하는 것을 고려하세요:
1. 데이터베이스 모델 변경 (PR #1)
2. API 엔드포인트 (PR #2)
3. 프론트엔드 컴포넌트 (PR #3)

이렇게 하면 리뷰가 더 쉽고 위험이 줄어듭니다."
```

### 시나리오 2: 테스트 누락
```
코멘트: "[BLOCKING] 다음에 대한 테스트를 추가해주세요:
- Happy path (사용자 생성 성공)
- 에러 케이스 (중복 이메일)
- 엣지 케이스 (유효하지 않은 이메일 형식)"
```

### 시나리오 3: 성능 우려
```
코멘트: "[BLOCKING] 이 쿼리는 N+1 문제를 일으킵니다.
현재: User.objects.all() 후 user.team을 순회
개선: User.objects.select_related('team')

쿼리 최적화 가이드라인은 database/patterns.mdc 참조하세요."
```

### 시나리오 4: 디자인 시스템 위반
```
코멘트: "[BLOCKING] 하드코딩된 색상 #079669 발견.
대신 CSS 변수 사용: var(--primary)

승인된 색상은 frontend/design-system.mdc 참조하세요."
```

### 시나리오 5: 보안 이슈
```
코멘트: "[BLOCKING] 이 엔드포인트에 인증이 없습니다.
@jwt_required 데코레이터 또는 IsAuthenticated 권한을 추가하세요.

인증 가이드라인은 general/security.mdc 참조하세요."
```

---

## 🚀 빠른 리뷰 워크플로우

### 리뷰어용
```
1. PR 설명 읽기
2. CI/CD 상태 확인 (녹색이어야 함)
3. 변경된 파일 리뷰
4. 필요시 로컬에서 실행
5. 카테고리 사용하여 피드백 제공
6. 승인 또는 변경 요청
```

### 작성자용
```
1. 완전한 템플릿으로 PR 생성
2. 셀프 리뷰 (체크리스트 사용)
3. 리뷰어 요청
4. 피드백에 신속히 대응
5. 변경 후 리뷰 재요청
6. 승인 후 병합
```

---

## 📝 좋은 PR 예시

### 예시 1: 기능 추가
```markdown
## feat(analytics): 팀 조율도 지표 추가

### 설명
TeamAnal 모델에 새로운 팀 조율도 지표(T_CO, A_CO, D_CO)와
해당 API 엔드포인트를 추가합니다.

### 변경 사항
- 조율도 필드로 TeamAnal 모델 업데이트
- API 엔드포인트 GET /api/team/coordination/ 추가
- 조율도 계산을 위한 단위 테스트 추가
- Swagger 문서 업데이트

### 테스팅
- ✅ 단위 테스트: 15개 새 테스트 추가, 모두 통과
- ✅ 통합 테스트: API 엔드포인트 테스트됨
- ✅ 수동 테스트: 스테이징 환경에서 검증

### 성능 영향
- 쿼리 시간: < 50ms (1000개 팀으로 테스트)
- N+1 쿼리 없음 (select_related 사용)

Closes #234
```

### 예시 2: 버그 수정
```markdown
## fix(auth): JWT 토큰 갱신 경합 조건 해결

### 설명
여러 동시 요청이 refresh token을 잘못 무효화할 수 있는
경합 조건을 수정합니다.

### 근본 원인
토큰 갱신 엔드포인트가 데이터베이스 트랜잭션을 사용하지 않아
동시 요청이 여러 refresh token을 생성할 수 있었습니다.

### 해결 방법
- 토큰 갱신 주위에 transaction.atomic() 추가
- refresh_token 테이블의 user_code에 unique 제약 추가
- 동시 업데이트 충돌에 대한 재시도 로직 추가

### 테스팅
- ✅ 동시성 테스트 추가 (10개 동시 요청)
- ✅ 단일 토큰 생성 검증
- ✅ 100명의 동시 사용자로 부하 테스트

Fixes #567
```

---

## 🔗 관련 가이드라인

**다음 단계:**
- 승인 후 → `general/version-control.mdc` (병합 가이드라인) 참조
- 테스팅은 → `general/testing-strategy.mdc` 참조
- 보안은 → `general/security.mdc` 참조
- 에러는 → `general/error-handling.mdc` 참조

**항상 참조:**
- `guidelines.mdc` - 핵심 제약사항
- `00-navigation-hub.mdc` - 규칙 네비게이션

---

**기억하세요: 코드 리뷰는 비판이 아닌 협업입니다. 목표는 함께 고품질 코드를 배포하는 것입니다!**
